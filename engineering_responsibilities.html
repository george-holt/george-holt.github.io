<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Engineering Responsibilities Radar Chart - George Holt" />
    <meta name="author" content="George Holt" />
    <meta name="keywords" content="engineering management, responsibilities, radar chart" />
    <meta name="robots" content="index, follow" />
    <meta name="theme-color" content="#ffffff" />

    <title>Engineering Responsibilities Comparison</title>

    <!-- Font loading optimization -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto:300" rel="stylesheet">

    <!-- Critical CSS Inlined -->
    <style>
      html {
        font-size: 14px;
      }
      :root {
        /* Color Palette */
        --primary-color: #007bff;
        --primary-hover: #0056b3;
        --accent-color: #0072b1;
        --text-primary: #333;
        --text-secondary: #666;
        --text-muted: #6c757d;
        --text-dark: #343a40;
        --background-primary: #ffffff;
        --background-secondary: #f8f9fa;
        --background-muted: #f1f1f1;
        --border-color: #dee2e6;
        
        /* Typography */
        --font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        --font-size-base: 1.4rem;
        --font-size-sm: 1rem;
        --font-size-lg: 1.8rem;
        --font-size-xl: 2.25rem;
        --font-size-2xl: 2.5rem;
        --line-height-base: 1.6;
        --line-height-tight: 1.3;
        
        /* Spacing */
        --spacing-xs: 0.5rem;
        --spacing-sm: 1rem;
        --spacing-md: 1.5rem;
        --spacing-lg: 2rem;
        --spacing-xl: 3rem;
        
        /* Border Radius */
        --border-radius: 8px;
        --border-radius-lg: 20px;
        
        /* Shadows */
        --shadow-sm: 0 1px 2px rgba(0,0,0,.04);
        --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.1);
        --shadow-lg: 0 4px 8px rgba(0, 123, 255, 0.3);
        
        /* Transitions */
        --transition-fast: 150ms ease-in-out;
        --transition-normal: 0.3s ease-in-out;
      }
      
      body {
        color: var(--text-primary);
        font-family: var(--font-family);
        padding-top: 70px;
        padding-bottom: 30px;
      }
      h1 { 
        font-size: var(--font-size-xl); 
        font-weight: 600; 
      }
      h2 { 
        font-size: 1.5rem; 
        font-weight: 500; 
        margin-top: var(--spacing-lg); 
      }
      p, li { 
        font-size: var(--font-size-base); 
        line-height: var(--line-height-base); 
      }
      .chart-container {
        max-width: 1200px;
        margin: 2rem auto;
        padding: 1rem;
        position: relative;
        height: auto;
        min-height: 500px;
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
      }
      .chart-container.loaded {
        opacity: 1;
      }
      .chart-layout {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        height: auto;
      }
      
      .chart-center {
        order: 1;
        min-height: 400px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .company-details {
        order: 2;
        width: 100%;
        padding: var(--spacing-xs) var(--spacing-xs);
        margin-bottom: var(--spacing-xs);
        background-color: var(--background-secondary);
        border-radius: var(--border-radius);
        border-left: 4px solid transparent;
        opacity: 0;
        transition: opacity var(--transition-normal);
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        contain: layout style;
      }
      
      .company-details.loaded {
        opacity: 1;
      }
      
      .company-details h4 {
        margin-top: 0;
        margin-bottom: var(--spacing-xs);
        font-size: 1.3rem;
        color: var(--text-dark);
      }
      
      .company-description {
        font-size: var(--font-size-lg);
        line-height: var(--line-height-tight);
        color: var(--text-primary);
        margin: 0;
      }

      .chart-container .well p, 
      .chart-container .well li {
        font-size: var(--font-size-lg);
        line-height: var(--line-height-tight);
      }
      .company-selector {
        margin-bottom: var(--spacing-lg);
        opacity: 0;
        transition: opacity var(--transition-normal);
      }
      .company-selector.loaded {
        opacity: 1;
      }
      .back-link {
        margin-bottom: 2rem;
      }
      .comparison-controls {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 1rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
      }
      .vs-label {
        font-weight: bold;
        color: #666;
        font-size: 1rem;
        align-self: flex-end;
        margin-bottom: 0.5rem;
      }
      .company-dropdown {
        min-width: 200px;
      }
      .dropdown-container {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-top: 0.5rem;
      }
      .legend {
        display: flex;
        justify-content: center;
        gap: 2rem;
        margin-top: 1rem;
        flex-wrap: wrap;
      }
      .legend-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .legend-color {
        width: 16px;
        height: 16px;
        border-radius: 3px;
        flex-shrink: 0;
      }
      canvas {
        max-width: 100%;
      }
    </style>

    <!-- Load jQuery -->
    <script src="https://code.jquery.com/jquery-latest.min.js"></script>
    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css?v=1.0" rel="stylesheet" />
    <!-- Bootstrap theme - Deferred -->
    <link href="css/bootstrap-theme.min.css?v=1.0" rel="stylesheet" media="print" onload="this.media='all'" />
    <!-- IE10 viewport hack - Deferred -->
    <link href="css/ie10-viewport-bug-workaround.css?v=1.0" rel="stylesheet" media="print" onload="this.media='all'" />

    <!-- Custom styles - Deferred -->
    <link href="css/custom.css?v=1.0" rel="stylesheet" media="print" onload="this.media='all'" />

    <script src="js/ie-emulation-modes-warning.js?v=1.0" defer></script>

    <!-- Chart.js and PapaParse for CSV handling -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
    <div class="container">
      <div class="back-link">
        <a href="index.html" class="btn btn-default">
          <span class="glyphicon glyphicon-arrow-left"></span> Back to Home
        </a>
      </div>

      <h1>What Engineering Managers Do In Different Companies</h1>
      <p class="lead">Compare how different companies emphasize various engineering management responsibilities.</p>

      <div class="company-selector">
        <div class="comparison-controls">
          <div>
            <label for="companyA" class="control-label">Select up to 2 companies:</label>
            <div class="dropdown-container">
              <select id="companyA" class="form-control company-dropdown"></select>
              <div class="legend-item">
                <div class="legend-color" style="background-color: rgba(54, 162, 235, 1);"></div>
              </div>
            </div>
          </div>
          <div class="vs-label">vs</div>
          <div>
            <label for="companyB" class="control-label">&nbsp;</label>
            <div class="dropdown-container">
              <select id="companyB" class="form-control company-dropdown"></select>
              <div class="legend-item">
                <div class="legend-color" style="background-color: rgba(255, 99, 132, 1);"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="chart-container">
        <div class="chart-layout">
          <div id="companyA-details" class="company-details">
            <h4>Select a company to see details...</h4>
            <p class="company-description">Choose a company from the dropdown above to view their engineering management focus areas.</p>
          </div>
          <div class="chart-center">
            <canvas id="radarChart"></canvas>
          </div>
          <div id="companyB-details" class="company-details">
            <h4>Select a company to see details...</h4>
            <p class="company-description">Choose a company from the dropdown above to view their engineering management focus areas.</p>
          </div>
        </div>
      </div>

      <div class="well">
        <h4>About this chart:</h4>
        <p>This radar chart shows the relative emphasis (1-5 scale) that different companies place on various engineering management responsibilities. The data is based on my observations and experience in the industry.</p>
        <ul id="responsibility-list">
          <li><strong>People Management:</strong> Team building, hiring, performance management</li>
          <li><strong>Tech Strategy:</strong> Technical direction, architecture decisions</li>
          <li><strong>Execution:</strong> Project delivery, timeline management</li>
          <li><strong>Product:</strong> Product strategy, feature prioritization</li>
          <li><strong>Customer:</strong> Customer engagement, requirements gathering</li>
          <li><strong>Quality:</strong> Code quality, testing, reliability</li>
          <li><strong>Cross-functional:</strong> Collaboration with other departments</li>
          <li><strong>IC Work:</strong> Individual contributor technical work</li>
          <li><strong>Tech Mentorship:</strong> Technical guidance and coaching</li>
        </ul>
      </div>
    </div>

    <script>
      // Auto-open DevTools Performance tab for profiling
      if (window.location.search.includes('profile=true')) {
        // Auto-open DevTools (Firefox doesn't support this directly, but we can prompt)
        console.log('🔍 Profiling mode detected!');
        console.log('📊 Please open DevTools (F12) and go to the Performance tab');
        console.log('⏱️ Then click Record and refresh the page to capture the first-load behavior');
        
        // Add a visual indicator
        const indicator = document.createElement('div');
        indicator.style.cssText = `
          position: fixed; top: 10px; right: 10px; 
          background: #ff6b6b; color: white; padding: 10px; 
          border-radius: 5px; z-index: 10000; font-family: monospace;
        `;
        indicator.textContent = '🔍 PROFILING MODE - Open DevTools Performance tab';
        document.body.appendChild(indicator);
      }

      // Performance logging for debugging
      const performanceObserver = new PerformanceObserver((list) => {
        for (const entry of list.getEntries()) {
          if (entry.entryType === 'paint') {
            console.log(`🎨 Paint: ${entry.name} at ${entry.startTime}ms`);
          }
        }
      });
      performanceObserver.observe({ entryTypes: ['paint'] });

      // Log layout shifts
      const layoutObserver = new PerformanceObserver((list) => {
        for (const entry of list.getEntries()) {
          console.log(`📐 Layout shift: ${entry.value} at ${entry.startTime}ms`);
        }
      });
      layoutObserver.observe({ entryTypes: ['layout-shift'] });


      
      // Mark key events
      performance.mark('page-load-start');

      // Master debug flag - set to true to enable all debug output
      const DEBUG_MODE = true;
      
      // Debug utility function
      function debug(...args) {
        if (DEBUG_MODE) {
          console.log(...args);
        }
      }
      
      function debugError(...args) {
        if (DEBUG_MODE) {
          console.error(...args);
        }
      }
      
      const csvPath = './data/engineering_responsibilities_compact.csv';
      const responsibilityLabels = [
        'People Management',
        'Tech Strategy',
        'Execution',
        'Product',
        'Customer',
        'Quality',
        'Cross-functional',
        'IC Work',
        'Tech Mentorship'
      ];

      const chartLabels = [
        'PeoplePri', 'TechPri', 'ExecPri', 'ProductPri', 'CustomerPri',
        'QualityPri', 'XFuncPri', 'TechConPri', 'MentorPri'
      ];

      let chart;
      let allData = [];
      let companyDetails = {};
      let responsibilityConfig = {};

      // Load company details with error handling
      const companyDetailsPath = './data/company_details.json';
      debug('Attempting to fetch company details from:', companyDetailsPath);
      fetch(companyDetailsPath)
        .then(response => {
          debug('Company details response status:', response.status, response.statusText);
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          companyDetails = data;
          debug('Company details loaded successfully');
          performance.mark('company-details-loaded');
          // Don't update chart here - let populateSelectors handle it
        })
        .catch(error => {
          debugError('Error loading company details:', error);
          // Continue without company details - chart will still work
          companyDetails = {};
        });

      // Parse responsibility config from CSV header
      function parseResponsibilityConfig(csvText) {
        const lines = csvText.split('\n');
        const header = lines[0];
        const columns = header.split(',');
        
        const config = {};
        const chartLabels = [];
        
        columns.forEach((column, index) => {
          if (column !== 'Company' && column.trim()) {
            const displayName = column.trim();
            const key = displayName.replace(/\s+/g, ''); // Remove spaces for key
            
            config[key] = {
              displayName: displayName,
              description: `${displayName} responsibilities and focus areas`
            };
            chartLabels.push(displayName);
          }
        });
        
        return { config, chartLabels };
      }

      // Load CSV with error handling
      const cacheBuster = '?v=1.0';
      const fullCsvPath = csvPath + cacheBuster;
      debug('Attempting to fetch CSV from:', fullCsvPath);
      fetch(fullCsvPath)
        .then(response => {
          debug('CSV response status:', response.status, response.statusText);
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.text();
        })
        .then(csv => {
          debug('Raw CSV content (first 200 chars):', csv.substring(0, 200));
          Papa.parse(csv, {
            header: true,
            dynamicTyping: true,
            complete: function(results) {
              if (results.errors.length > 0) {
                debugError('CSV parsing errors:', results.errors);
              }
              if (!results.data || results.data.length === 0) {
                debugError('No data found in CSV');
                return;
              }
              allData = results.data;
              debug('CSV data loaded:', allData);
              responsibilityConfig = parseResponsibilityConfig(csv).config;
              performance.mark('csv-data-loaded');
              populateAboutSection();
              populateSelectors(results.data);
            },
            error: function(error) {
              debugError('PapaParse error:', error);
            }
          });
        })
        .catch(error => {
          debugError('Error loading CSV:', error);
          // Try alternative path if first one fails
          if (csvPath.startsWith('./')) {
            const altPath = csvPath.substring(2) + cacheBuster;
            debug('Trying alternative path:', altPath);
            fetch(altPath)
              .then(response => response.text())
              .then(csv => {
                debug('Raw CSV content (alt path, first 200 chars):', csv.substring(0, 200));
                Papa.parse(csv, {
                  header: true,
                  dynamicTyping: true,
                  complete: function(results) {
                    if (results.data && results.data.length > 0) {
                      allData = results.data;
                      debug('CSV data loaded (alternative path):', allData);
                      debug('Snowflake data:', allData.find(d => d.Company === 'Snowflake'));
                      debug('Snowflake MentorPri value:', allData.find(d => d.Company === 'Snowflake')?.MentorPri);
                      responsibilityConfig = parseResponsibilityConfig(csv).config;
                      populateAboutSection();
                      populateSelectors(results.data);
                    }
                  }
                });
              })
              .catch(altError => {
                debugError('Alternative path also failed:', altError);
              });
          }
        });

      // Fallback for older browsers that don't support fetch
      if (typeof fetch === 'undefined') {
        debugError('Fetch API not supported - this browser may not work properly');
      }

      // Debug: Check actual font sizes
      setTimeout(() => {
        if (!DEBUG_MODE) return;
        
        // Log performance measurements with error handling
        try {
          if (performance.getEntriesByName('page-load-start').length > 0 && 
              performance.getEntriesByName('chart-rendered').length > 0) {
            performance.measure('total-load-time', 'page-load-start', 'chart-rendered');
          }
          
          if (performance.getEntriesByName('page-load-start').length > 0 && 
              performance.getEntriesByName('csv-data-loaded').length > 0) {
            performance.measure('data-load-time', 'page-load-start', 'csv-data-loaded');
          }
          
          if (performance.getEntriesByName('csv-data-loaded').length > 0 && 
              performance.getEntriesByName('chart-rendered').length > 0) {
            performance.measure('chart-render-time', 'csv-data-loaded', 'chart-rendered');
          }
          
          performance.getEntriesByType('measure').forEach(measure => {
            console.log(`⏱️ ${measure.name}: ${measure.duration}ms`);
          });
        } catch (error) {
          console.log('⚠️ Performance measurement error:', error.message);
        }
        
        const subtitle = document.querySelector('.lead');
        const companyDesc = document.querySelector('.company-description');
        const aboutText = document.querySelector('.well p');
        
        if (subtitle) {
          const subtitleSize = window.getComputedStyle(subtitle).fontSize;
          debug('Subtitle font size:', subtitleSize);
        }
        if (companyDesc) {
          const descSize = window.getComputedStyle(companyDesc).fontSize;
          debug('Company description font size:', descSize);
        }
        if (aboutText) {
          const aboutSize = window.getComputedStyle(aboutText).fontSize;
          debug('About section font size:', aboutSize);
        }
        
        // Also check the root font size
        const rootSize = window.getComputedStyle(document.documentElement).fontSize;
        debug('Root font size:', rootSize);
      }, 1000);

      function renderChart(companyA, companyB) {
        const ctx = document.getElementById('radarChart');
        if (!ctx) {
          console.error('Canvas element not found');
          return;
        }

        const context = ctx.getContext('2d');
        if (!context) {
          console.error('Could not get canvas context');
          return;
        }
        
        if (chart) {
          chart.destroy();
        }

        const datasets = [];

        // Add Company A if selected
        if (companyA) {
          const chartLabels = Object.keys(responsibilityConfig);
          const dataA = chartLabels.map(label => {
            const displayName = responsibilityConfig[label].displayName;
            return companyA[displayName] ?? 0;
          });
          datasets.push({
            label: companyA.Company,
            data: dataA,
            fill: true,
            backgroundColor: 'rgba(54, 162, 235, 0.2)',
            borderColor: 'rgba(54, 162, 235, 1)',
            pointBackgroundColor: 'rgba(54, 162, 235, 1)',
            pointBorderColor: '#fff',
            pointHoverBackgroundColor: '#fff',
            pointHoverBorderColor: 'rgba(54, 162, 235, 1)'
          });
        }

        // Add Company B if selected
        if (companyB) {
          const chartLabels = Object.keys(responsibilityConfig);
          const dataB = chartLabels.map(label => {
            const displayName = responsibilityConfig[label].displayName;
            return companyB[displayName] ?? 0;
          });
          datasets.push({
            label: companyB.Company,
            data: dataB,
            fill: true,
            backgroundColor: 'rgba(255, 99, 132, 0.2)',
            borderColor: 'rgba(255, 99, 132, 1)',
            pointBackgroundColor: 'rgba(255, 99, 132, 1)',
            pointBorderColor: '#fff',
            pointHoverBackgroundColor: '#fff',
            pointHoverBorderColor: 'rgba(255, 99, 132, 1)'
          });
        }

        try {
          chart = new Chart(ctx, {
            type: 'radar',
            data: {
              labels: Object.values(responsibilityConfig).map(r => r.displayName),
              datasets: datasets
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: false
                }
              },
              scales: {
                r: {
                  min: 0,
                  max: 5,
                  beginAtZero: true,
                  ticks: {
                    stepSize: 1,
                    callback: function(value) {
                      return value;
                    }
                  },
                  pointLabels: {
                    font: {
                      size: 12
                    },
                    callback: function(value) {
                      // Split long labels into multiple lines
                      const words = value.split(' ');
                      if (words.length > 1) {
                        return words;
                      }
                      return value;
                    }
                  }
                }
              }
            }
          });
          
          performance.mark('chart-rendered');
          
          // Add loaded class immediately after chart creation
          const chartContainer = document.querySelector('.chart-container');
          if (chartContainer) {
            chartContainer.classList.add('loaded');
          }
        } catch (error) {
          console.error('Error creating chart:', error);
          // Fail quietly - just don't show the chart
        }
      }

      function populateAboutSection() {
        const list = document.getElementById('responsibility-list');
        if (!list) return;
        
        list.innerHTML = '';
        Object.values(responsibilityConfig).forEach(responsibility => {
          const li = document.createElement('li');
          li.innerHTML = `<strong>${responsibility.displayName}:</strong> ${responsibility.description}`;
          list.appendChild(li);
        });
      }

      function populateSelectors(data) {
        const selectA = document.getElementById('companyA');
        const selectB = document.getElementById('companyB');
        
        if (!selectA || !selectB) {
          console.error('Company selector elements not found');
          return;
        }
        
        const validRows = data.filter(row => row.Company);
        
        if (validRows.length === 0) {
          console.error('No valid company data found');
          // Fail quietly - just leave dropdowns empty
          return;
        }
        
        // Clear existing options
        selectA.innerHTML = '';
        selectB.innerHTML = '';
        
        validRows.forEach(row => {
          const optA = document.createElement('option');
          optA.value = row.Company;
          optA.textContent = row.Company;
          selectA.appendChild(optA);

          const optB = document.createElement('option');
          optB.value = row.Company;
          optB.textContent = row.Company;
          selectB.appendChild(optB);
        });

        // Set default selections
        if (validRows.length >= 2) {
          selectA.value = validRows[0].Company;
          selectB.value = validRows[1].Company;
        }

        // Add event listeners
        selectA.addEventListener('change', updateChart);
        selectB.addEventListener('change', updateChart);
        
        // Add loaded class to company selector for fade-in
        const companySelector = document.querySelector('.company-selector');
        if (companySelector) {
          companySelector.classList.add('loaded');
        }
        
        // Single coordinated update: update chart and fade-in together
        updateChart();
        
        // Add loaded classes immediately after chart update
        const companyADetails = document.getElementById('companyA-details');
        const companyBDetails = document.getElementById('companyB-details');
        if (companyADetails) companyADetails.classList.add('loaded');
        if (companyBDetails) companyBDetails.classList.add('loaded');
      }

      function updateChart() {
        const companyA = document.getElementById('companyA')?.value || '';
        const companyB = document.getElementById('companyB')?.value || '';
        
        const dataA = companyA ? allData.find(d => d.Company === companyA) : null;
        const dataB = companyB ? allData.find(d => d.Company === companyB) : null;
        
        // Batch DOM updates to reduce reflow
        requestAnimationFrame(() => {
          // Update company details
          updateCompanyDetails('companyA-details', companyA, 'rgba(54, 162, 235, 1)');
          updateCompanyDetails('companyB-details', companyB, 'rgba(255, 99, 132, 1)');
          
          // Render chart in the same frame
          renderChart(dataA, dataB);
        });
      }

      function updateCompanyDetails(elementId, companyName, color) {
        debug(`Updating company details for ${elementId}: ${companyName}`);
        const element = document.getElementById(elementId);
        if (!element) {
          console.error(`Element ${elementId} not found`);
          return;
        }

        const titleElement = element.querySelector('h4');
        const descriptionElement = element.querySelector('.company-description');
        
        if (!titleElement || !descriptionElement) {
          console.error(`Required elements not found in ${elementId}`);
          return;
        }
        
        if (companyName && companyDetails[companyName]) {
          titleElement.textContent = companyName;
          titleElement.style.color = color;
          descriptionElement.textContent = companyDetails[companyName];
          element.style.borderLeftColor = color;
        } else {
          titleElement.textContent = elementId === 'companyA-details' ? 'Company 1 Details' : 'Company 2 Details';
          titleElement.style.color = '#495057';
          descriptionElement.textContent = companyName ? 
            `No details available for "${companyName}"` : 
            'Select a company to see details...';
          element.style.borderLeftColor = 'transparent';
        }
      }
    </script>

    <!-- Bootstrap core JavaScript -->
    <script>
      window.jQuery || document.write('<script src="/js/vendor/jquery.min.js"><\/script>');
    </script>
    <script src="js/bootstrap.min.js?v=1.0" defer></script>
    <script src="js/docs.min.js?v=1.0" defer></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="js/ie10-viewport-bug-workaround.js?v=1.0" defer></script>
  </body>
</html>
